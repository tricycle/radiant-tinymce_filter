(function(){tinymce.create("tinymce.plugins.RadiantLinkingPlugin",{getInfo:function(){return{longname:"Radiant Linking Integration",author:"Gerrit Kaiser, Tricycle Developments",authorurl:"http://tricycledevelopments.com",infourl:"http://github.com/tricycle/radiant-tinymce_filter/tree/",version:"0.1"}},init:function(A,B){this.editor=A;A.addCommand("mceRadiantLinkDialog",function(){var C=A.selection;if(C.isCollapsed()&&!A.dom.getParent(C.getNode(),"A")){return }RadiantLinkingPopup.show()});A.addButton("internalLink",{title:"advlink.link_desc",cmd:"mceRadiantLinkDialog"});A.addShortcut("ctrl+k","advlink.advlink_desc","mceRadiantLinkDialog");A.onNodeChange.add(function(D,C,F,E){C.setDisabled("link",E&&F.nodeName!="A");C.setActive("link",F.nodeName=="A"&&!F.name)})}});tinymce.PluginManager.add("radiant_linking",tinymce.plugins.RadiantLinkingPlugin)})();var RadiantLinkingPopup={id:"tinymce-linking-popup",show:function(){var A=$(this.id);center(A);A.show()},close:function(){$(this.id).up(".popup").hide()},insertLink:function(B){var A=tinymce.EditorManager.activeEditor;var C=A.dom.getParent(A.selection.getNode(),"A");tinyMCEPopup.execCommand("mceBeginUndoLevel");if(C==null){A.execCommand("CreateLink",false,B,{skip_undo:true})}else{e.href=B}tinyMCEPopup.execCommand("mceEndUndoLevel");this.close()}};var MiniSiteMap=Class.create(SiteMap,{getBranch:function(B){var D=this.extractPageId(B),C=this.extractLevel(B),A=$("busy-"+D);new Ajax.Updater(B,"../admin/pagetree/children/"+D+"/"+C,{insertion:"after",onLoading:function(){A.show();this.updating=true}.bind(this),onComplete:function(){A.fade();this.updating=false}.bind(this),method:"get"})}});document.observe("dom:loaded",function(){when("table.index",function(A){if(A.identify()=="wysiwyg-site-map"){new MiniSiteMap(A)}});$$("#wysiwyg-site-map a").each(function(A){A.observe("click",function(B){B.stop();RadiantLinkingPopup.insertLink(this.title);$(this).up(".popup").hide()})})});